jQuery.extend({stephanTalking:{settings:{sample_resolution:12e3,phonemes:{A:{f:[10,55,0],w:[10,10,0],dur:3,vol:6,osc:0,plo:0},a:{f:[20,35,0],w:[10,10,0],dur:4,vol:12,osc:0,plo:0},b:{f:[4,0,0],w:[10,0,0],dur:1,vol:1,osc:0,plo:0},c:{f:[35,0,0],w:[15,0,0],dur:4,vol:2,osc:1,plo:0},d:{f:[4,40,80],w:[10,10,10],dur:1,vol:2,osc:0,plo:0},E:{f:[5,56,0],w:[10,10,0],dur:3,vol:3,osc:0,plo:0},e:{f:[14,50,0],w:[10,10,0],dur:3,vol:10,osc:0,plo:0},f:{f:[8,20,34],w:[10,10,10],dur:3,vol:3,osc:1,plo:0},g:{f:[2,10,26],w:[15,5,2],dur:2,vol:1,osc:0,plo:0},h:{f:[22,26,32],w:[30,10,30],dur:1,vol:5,osc:1,plo:0},I:{dur:3.5,arr:[{k:"a",dur:2},{},{k:"E",dur:1}]},i:{f:[5,56,0],w:[10,10,0],dur:2,vol:2,osc:0,plo:0},j:{f:[5,56,0],w:[10,10,0],dur:1,vol:5,osc:0,plo:0},k:{f:[20,80,0],w:[10,10,0],dur:1,vol:2,osc:1,plo:1},l:{f:[8,20,0],w:[10,10,0],dur:3,vol:5,osc:0,plo:0},m:{f:[4,20,0],w:[10,10,0],dur:3,vol:2,osc:0,plo:0},n:{f:[4,40,0],w:[10,10,0],dur:3,vol:2,osc:0,plo:0},O:{f:[12,15,0],w:[10,10,0],dur:3,vol:6,osc:0,plo:0},o:{f:[19,33,0],w:[10,10,0],dur:3,vol:12,osc:0,plo:0},p:{f:[4,10,20],w:[5,10,10],dur:1,vol:2,osc:1,plo:1},r:{f:[3,10,20],w:[30,8,1],dur:4,vol:5,osc:0,plo:0},s:{f:[80,110,0],w:[80,40,0],dur:3,vol:5,osc:1,plo:0},t:{f:[4,20,40],w:[10,20,5],dur:1,vol:3,osc:1,plo:1},U:{f:[5,14,0],w:[10,10,0],dur:3,vol:2,osc:0,plo:0},u:{f:[18,30,0],w:[10,10,0],dur:3,vol:12,osc:0,plo:0},v:{f:[2,20,0],w:[20,10,0],dur:3,vol:3,osc:0,plo:0},w:{f:[3,14,0],w:[10,10,0],dur:3,vol:2,osc:0,plo:0},y:{f:[5,56,0],w:[10,10,0],dur:3,vol:4,osc:0,plo:0},z:{f:[5,28,80],w:[10,5,10],dur:4,vol:5,osc:0,plo:0}},space_ltrs:" ..\n",quarter_spc_ltr:"_",eighth_spc_ltr:"-"},setting:function(e){if(!e)return;for(var t in e){if(this.settings[t]){this.settings[t]=e[t]}}},speak:function(e){function F(e){function o(){function r(e,t){return R(e,t,-t)}function s(e){return.5-(e-Math.floor(e/n)*n)/n}if(M){A*=1.5;M=false}if(e.d)A=R(A+e.d,1,100);S=parseInt(A*m);C=i;if(e.p)C+=e.p;for(w=0;w<3;w++){if(!h.f[w])continue;N=h.f[w]*p;y=0;b=0;k=1-h.w[w]*d;g=l;T=0;for(E=0;E<S;E++){if(!h.osc){x=s(E*(C*n/t.sample_resolution));T=0}else{x=Math.random()-.5}if(e.v)x*=e.v;x=x+2*Math.cos(n*N)*y*k-b*k*k;b=y;y=x;x=.75*T+x*O*v;T=x;x*=r(Math.sin(Math.PI*E/S)*5,1)*10;P[g++]=P[g]/2+x}}l+=S-parseInt(A/3*m);if(h.plo)l+=parseInt(m*2)}if(L=h.arr){for(var r,s=0;r=L[s];s++){if(h=t.phonemes[r.k]){O=r.vol||h.vol;A=r.dur||h.dur;o()}else{l+=parseInt(a/2)}}}else{O=h.vol;A=h.dur;o()}}function I(e,t,n){var r={RIFF:{chunk_id:[4,"RIFF"],chunk_size:[4,36+n],type:[4,"WAVE"]},fmt:{chunk_id:[4,"fmt "],chunk_size:[4,16],compression:[2,1],channels:[2,1],sample_rate:[4,t],bytes_per_sec:[4,t*2],block_align:[2,2],bits_per_sample:[2,e]},data:{chunk_id:[4,"data"],chunk_size:[4,n],dummy_sample:[4,0]}};var i="",s,o;for(var u in r){for(s in r[u]){o=r[u][s][1];if(typeof o=="string"){i+=r[u][s][1]}else{i+=String.fromCharCode(o&255,o>>8&255);if(r[u][s][0]==4)i+=String.fromCharCode(o>>16&255,o>>24&255)}}}return i}function q(e,t,n,r){if(t)return R(t,n,r);else return e}function R(e,t,n){e=e*1;if(isNaN(e)||e>n)e=n;else if(e<t)e=t;return e}if(!e)return;if(typeof e=="string")e={i:e};if(!e.i)return;var t=this.settings,n=2*Math.PI,r=e.i,i=q(95,e.p,50,450),s=q(.685,e.c,.3,1),o=q(.72,e.v,.3,1),u=typeof r=="string",a=parseInt(Math.floor(t.sample_resolution*s*.33)),f,l=0,c,h,p=50/t.sample_resolution,d=Math.PI*10/t.sample_resolution,v=parseInt(44100/t.sample_resolution)*parseInt(44100/t.sample_resolution),m=parseInt(t.sample_resolution/17*s),g,y,b,w,E,S,x,T,N,C,k,L,A,O,M;if(u)r+=" ";else r.push({k:" "});var _=r.length;if(u){f=Math.ceil(t.sample_resolution/2*s)*_}else{f=0;for(var D=0;D<_;D++){c=r[D].k;if(h=t.phonemes[c]){if(A=r[D].d)f+=R(h.dur+A,1,100);else f+=h.dur}else if(t.space_ltrs.indexOf(c)>=0){f+=r[D].d||1}else if(c==t.quarter_spc_ltr){f+=.25}else if(c==t.eighth_spc_ltr){f+=.125}}f=Math.ceil(t.sample_resolution*s*f/4)}f+=f%2;var P=window.ArrayBuffer?new Int16Array(new ArrayBuffer(f)):new Array(f);M=true;for(var D=0;D<_;D++){c=u?r[D]:r[D].k;if(h=t.phonemes[c]){F(r[D])}else if(t.space_ltrs.indexOf(c)>=0){l+=a*(r[D].d||1);M=true}else if(c==t.quarter_spc_ltr){l+=parseInt(a/4)}else if(c==t.eighth_spc_ltr){l+=parseInt(a/8)}}if(!this.audio_el)this.audio_el=new Audio;var H=this.audio_el,B=I(16,t.sample_resolution,l*2+2),j="",x;for(D=0;D<l;D++){x=P[D];j+=String.fromCharCode(x&255,x>>8&255)}H.src="data:audio/wav;base64,"+btoa(B+j);H.volume=o;H.play()}}})